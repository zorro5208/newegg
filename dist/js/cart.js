"use strict";$(function(){function e(){var t=decodeURI(location.search).slice(1),n=$.cookie("uid");$.ajax({type:"get",url:"../api/cart.php",data:{gid:t,uid:n},success:function(t){var n=JSON.parse(t).map(function(t){return'\n                       \t\t\t\t\t<tr class="bb " data-id="'+t.cid+'">\n                       \t\t\t\t\t<td class="pt20 ">\n                       \t\t\t\t\t\t<input class="vm cbx btn"  type="checkbox">\n                       \t\t\t\t\t</td>\n                       \t\t\t\t\t<td valign="top " class="pt20 pd ">\n                       \t\t\t\t\t\t<table width="100% " border="0">\n                       \t\t\t\t\t\t\t<tr>\n                       \t\t\t\t\t\t\t\t<td valign="top " class="pt20 " width="80 ">\n                       \t\t\t\t\t\t\t\t\t<a href="javascript:; " class="a_img "><img src="../img/'+t.imgurl+'"/></a>\n                       \t\t\t\t\t\t\t\t</td>\n                       \t\t\t\t\t\t\t\t<td class="pl10 pb20 " valign="top ">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a href="javascript:; " class="a_title ">'+t.name+'</a>\n                       \t\t\t\t\t\t\t\t</td>\n                       \t\t\t\t\t\t\t\t\n                       \t\t\t\t\t\t\t</tr>\n                       \t\t\t\t\t\t</table>\n                       \t\t\t\t\t</td>\n                       \t\t\t\t\t<td align="center " valign="middle " class="pt20 ">\n                       \t\t\t\t\t\t<p class="price Arial14 ">'+t.price+'</p>\n                       \t\t\t\t\t</td>\n                       \t\t\t\t\t<td align="center " valign="middle " class="pt20 ">\n                       \t\t\t\t\t\t<div class="center ">\n                       \t\t\t\t\t\t\t<input class="textbox tex" type="text " data-num="'+t.num+'" value="'+t.count+'" >\n                       \t\t\t\t\t\t\t<span class="inlineblock">\n                           \t\t\t\t\t\t\t<span class="plusminus " ></span>\n                            \t\t\t\t\t\t<span class="plusminus1 minus "></span>\n                       \t\t\t\t\t\t\t</span>\n                       \t\t\t\t\t\t</div>\n                       \t\t\t\t\t</td>\n                       \t\t\t\t\t<td align="center " valign="middle " class="pt20 ">\n                       \t\t\t\t\t\t<span class="orange Arial14 qq ">￥'+t.price*t.count+'</span>\n                       \t\t\t\t\t</td>\n                       \t\t\t\t\t<td align="center " valign="middle " class="pt20 pr10 ">\n                       \t\t\t\t\t\t<a href="'+t.cid+'" class="del">删除</a><br />\n                       \t\t\t\t\t</td>\n                       \t\t\t\t</tr>\n                       \t\t\t\t'}).join("");$(".zhuti").append(n)}})}function i(t){var n=$(t).parent().prev().val(),a=$(t).parent().parent().parent().prev().children().text(),e=parseInt((n*a).toFixed(0));console.log(n,a,e),$(t).parent().parent().parent().next().children().html("￥"+e),p()}e(),$(".zhuti").on("click",".plusminus ",function(){var t=$(this).parent().parent().parent().parent().data("id"),n=$(this).parent().prev().val(),a=$(this).parent().prev().data("num");a<=++n&&(n=a),$.ajax({type:"get",url:"../api/updateCart.php",data:"cid="+t+"&nums="+n,success:function(){}}),$(this).parent().prev().val(n),i($(this))}),$(".zhuti").on("click",".minus",function(){var t=$(this).parent().parent().parent().parent().data("id"),n=$(this).parent().prev().val();--n<=1&&(n=1),$.ajax({type:"get",url:"../api/updateCart.php",data:"cid="+t+"&nums="+n,success:function(){}}),$(this).parent().prev().val(n),i($(this))}),$(".zhuti").on("input",".textbox",function(){var t=$(this).parent().parent().parent().data("id"),n=$(this).val(),a=$(this).data("num");n<=1?n=1:a<=n&&(n=a),$.ajax({type:"get",url:"../api/updateCart.php",data:"cid="+t+"&nums="+n,success:function(){}}),$(this).val(n),i($(this))}),$(".zhuti").on("click",".del",function(t){t.preventDefault();var n=$(this).attr("href");console.log(n),confirm("您确定要删除吗？")&&$.ajax({type:"get",url:"../api/delCart.php",data:{cid:n},success:function(t){"yes"==t?($(".bb").remove(),e(),$(".qx").prop("checked",!1)):alert("删除失败")}}),update()}),$(".goodslist input").click(function(){var t=$(".goodslist input").prop("checked");$(".cbx").prop("checked",t),p()}),$(".zhuti").on("click",".cbx",function(){$(".btn:checked").size()==$(".btn").size()?$(".goodslist input").prop("checked",!0):$(".goodslist input").prop("checked",!1),p()});var c=[];function p(){$(".btn").each(function(t,n){$(n).prop("checked")&&c.push(t)});var n=0,a=0;c.forEach(function(t){n+=1*$(".tex").eq(t).val(),a+=1*$(".qq").eq(t).text().slice(1),console.log(a)}),$(".count").html("已选 "+n+" 件商品"),$(".qqq").html("￥"+a.toFixed(2)),c=[]}$(".delall").click(function(){var a=[];if($(".btn").each(function(t,n){$(n).prop("checked")&&a.push(t)}),confirm("您确定要全删吗？")){for(var t=a.length-1;0<=t;t--)$(".bb").eq(a[t]).remove();var n=$.cookie("uid");$.ajax({type:"get",url:"../api/clearCart.php",data:{uid:n},success:function(t){"yes"==t?($(".zhuti").remove(),e(),$(".tip").show(),$(".qx").prop("checked",!1)):alert("删除失败")}}),p()}})});